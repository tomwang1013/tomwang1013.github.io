<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>web component之custom element | tomwang1013的学习总结 | 今歌爸爸的学习记录及生活点滴</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="html5,web component">
    <meta name="description" content="web component是html5原生的组件机制，它由四个标准组成：  custom element shadow dom html template html import  这些标准可以单独使用，也可以结合在一起使用，今天先介绍一下custom element，后面会依次介绍其他几个 native elements与custom elementshtml文档由很多基本元素组成，如div,">
<meta property="og:type" content="article">
<meta property="og:title" content="web component之custom element">
<meta property="og:url" content="http://tomwang1013.github.io/web-componet-custom-element/index.html">
<meta property="og:site_name" content="tomwang1013的学习总结">
<meta property="og:description" content="web component是html5原生的组件机制，它由四个标准组成：  custom element shadow dom html template html import  这些标准可以单独使用，也可以结合在一起使用，今天先介绍一下custom element，后面会依次介绍其他几个 native elements与custom elementshtml文档由很多基本元素组成，如div,">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://tomwang1013.github.io/images/1540262306376.png">
<meta property="og:image" content="http://tomwang1013.github.io/images/1540262867740.png">
<meta property="og:image" content="http://tomwang1013.github.io/images/1540262877824.png">
<meta property="og:image" content="http://tomwang1013.github.io/images/1540264685155.png">
<meta property="og:image" content="http://tomwang1013.github.io/images/1540264712762.png">
<meta property="article:published_time" content="2018-10-22T05:57:34.000Z">
<meta property="article:modified_time" content="2023-07-18T03:20:12.568Z">
<meta property="article:author" content="wang xiantong">
<meta property="article:tag" content="html5">
<meta property="article:tag" content="web component">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://tomwang1013.github.io/images/1540262306376.png">
    
        <link rel="alternate" type="application/atom+xml" title="tomwang1013的学习总结" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

<meta name="generator" content="Hexo 6.3.0"></head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">wang xiantong</h5>
          <a href="mailto:174604588@qq.com" title="174604588@qq.com" class="mail">174604588@qq.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/tomwang1013" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="http://www.weibo.com/tomwanglnnxq" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/about"  >
                <i class="icon icon-lg icon-link"></i>
                关于
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">web component之custom element</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">web component之custom element</h1>
        <h5 class="subtitle">
            
                <time datetime="2018-10-22T05:57:34.000Z" itemprop="datePublished" class="page-time">
  2018-10-22
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/programming/">programming</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#native-elements%E4%B8%8Ecustom-elements"><span class="post-toc-number">1.</span> <span class="post-toc-text">native elements与custom elements</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E5%88%9B%E5%BB%BA%E4%B8%80%E7%A7%8D%E8%87%AA%E5%AE%9A%E4%B9%89%E5%85%83%E7%B4%A0"><span class="post-toc-number">2.</span> <span class="post-toc-text">创建一种自定义元素</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E9%92%A9%E5%AD%90%E5%87%BD%E6%95%B0"><span class="post-toc-number">3.</span> <span class="post-toc-text">钩子函数</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%85%83%E7%B4%A0%E7%9A%84%E2%80%9D%E5%8D%87%E7%BA%A7%E2%80%9D-upgrade"><span class="post-toc-number">4.</span> <span class="post-toc-text">自定义元素的”升级”(upgrade)</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%85%83%E7%B4%A0%E7%9A%84%E5%B1%95%E7%A4%BA"><span class="post-toc-number">5.</span> <span class="post-toc-text">自定义元素的展示</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%86%85%E5%AE%B9"><span class="post-toc-number">5.1.</span> <span class="post-toc-text">内容</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E6%A0%B7%E5%BC%8F"><span class="post-toc-number">5.2.</span> <span class="post-toc-text">样式</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E6%80%BB%E7%BB%93"><span class="post-toc-number">6.</span> <span class="post-toc-text">总结</span></a></li></ol>
        </nav>
    </aside>


<article id="post-web-componet-custom-element"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">web component之custom element</h1>
        <div class="post-meta">
            <time class="post-time" title="2018-10-22 13:57:34" datetime="2018-10-22T05:57:34.000Z"  itemprop="datePublished">2018-10-22</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/programming/">programming</a></li></ul>



            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <p><strong>web component</strong>是html5原生的组件机制，它由四个标准组成：</p>
<ol>
<li>custom element</li>
<li>shadow dom</li>
<li>html template</li>
<li>html import</li>
</ol>
<p>这些标准可以单独使用，也可以结合在一起使用，今天先介绍一下<code>custom element</code>，后面会依次介绍其他几个</p>
<h1 id="native-elements与custom-elements"><a href="#native-elements与custom-elements" class="headerlink" title="native elements与custom elements"></a>native elements与custom elements</h1><p>html文档由很多基本元素组成，如<code>div</code>, <code>span</code>, <code>ul</code>等等，我们可以称这些已经存在的元素为<code>native elements(本地元素)</code>。每一种本地元素都有一个class与之对应，如<code>div</code>对应<code>HTMLDivElement</code>, <code>span</code>对应<code>HTMLSpanElement</code>，<code>ul</code>对应<code>HTMLUListElement</code>，这些class都是从<code>HTMLElement</code>继承下来</p>
<p>一个自然而然的想法是：我们能否创建一些自定义元素并使用自定义标签呢？如：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">my-tag</span>&gt;</span><span class="tag">&lt;/<span class="name">my-tag</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>答案是可以，这就是<strong>custom elements</strong>的由来</p>
<h1 id="创建一种自定义元素"><a href="#创建一种自定义元素" class="headerlink" title="创建一种自定义元素"></a>创建一种自定义元素</h1><p>要创建一种自定义元素，我们首先要准备一个class，就像本地的<code>HTMLDivElement</code>一样，从<code>HTMLElement</code>继承，用来定义元素的内在行为，假设我们要创建一个表示时钟的元素，我们可以这样做：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">HTMLClockElement</span> <span class="keyword">extends</span> <span class="title class_ inherited__">HTMLElement</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>();</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>像<code>div</code>一样我们还需要指定这个元素对应的标签名，这样我们就能直接在html语言中使用这个元素了，我们把这个动作叫<strong>注册自定义元素</strong>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">customElements.<span class="title function_">define</span>(<span class="string">&#x27;x-clock&#x27;</span>, <span class="title class_">HTMLClockElement</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">x-clock</span>&gt;</span><span class="tag">&lt;/<span class="name">x-clock</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>关于元素的标签名需要注意的是：</p>
<ul>
<li>它们必须包含短横线(-)，这样浏览器在解析的时候才能将它们和本地元素区分开来</li>
<li>在使用的时候不能自包含(self-closing:<code>&lt;x-clock/&gt;</code>)，必须使用结束标签</li>
</ul>
<h1 id="钩子函数"><a href="#钩子函数" class="headerlink" title="钩子函数"></a>钩子函数</h1><p>在自定义元素的生命周期中有一些钩子(lifecycle hooks)，我们可以在其中做一些适当的响应处理：</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>调用时机(Called when)</th>
</tr>
</thead>
<tbody><tr>
<td><code>constructor</code></td>
<td>An instance of the element is created or <a target="_blank" rel="noopener" href="https://developers.google.com/web/fundamentals/web-components/customelements#upgrades">upgraded</a>. Useful for initializing state, settings up event listeners, or <a target="_blank" rel="noopener" href="https://developers.google.com/web/fundamentals/web-components/customelements#shadowdom">creating shadow dom</a>. See the <a target="_blank" rel="noopener" href="https://html.spec.whatwg.org/multipage/scripting.html#custom-element-conformance">spec </a>for restrictions on what you can do in the <code>constructor</code>.</td>
</tr>
<tr>
<td><code>connectedCallback</code></td>
<td>Called every time the element is inserted into the DOM. Useful for running setup code, such as fetching resources or rendering. Generally, you should try to delay work until this time.</td>
</tr>
<tr>
<td><code>disconnectedCallback</code></td>
<td>Called every time the element is removed from the DOM. Useful for running clean up code.</td>
</tr>
<tr>
<td><code>attributeChangedCallback(attrName, oldVal, newVal)</code></td>
<td>Called when an <a target="_blank" rel="noopener" href="https://developers.google.com/web/fundamentals/web-components/customelements#attrchanges">observed attribute</a> has been added, removed, updated, or replaced. Also called for initial values when an element is created by the parser, or <a target="_blank" rel="noopener" href="https://developers.google.com/web/fundamentals/web-components/customelements#upgrades">upgraded</a>. <strong>Note:</strong> only attributes listed in the <code>observedAttributes</code> property will receive this callback.</td>
</tr>
<tr>
<td><code>adoptedCallback()</code></td>
<td>The custom element has been moved into a new <code>document</code> (e.g. someone called <code>document.adoptNode(el)</code>).</td>
</tr>
</tbody></table>
<p><code>constructor</code>,<code>connectedCallback</code>,<code>disconnectedCallback</code>都很好理解，我们说下<code>attributeChangedCallback</code>和<code>adoptedCallback</code>：</p>
<ul>
<li><p><code>attributeChangedCallback</code></p>
<p>在使用元素的时候我们经常要指定一些属性，不同的元素需要指定不同的属性，如<code>img</code>元素有<code>src</code>属性，<code>input</code>元素有<code>disabled</code>, <code>value</code>等属性，这些都是浏览器内置的。作为自定义元素的作者，我们需要决定元素需要哪些属性供使用者使用，如：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">x-clock</span> <span class="attr">disabled</span> <span class="attr">hour</span>=<span class="string">&quot;4&quot;</span> <span class="attr">minute</span>=<span class="string">&quot;30&quot;</span> <span class="attr">second</span>=<span class="string">&quot;0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">x-clock</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在这些属性中，我们可以指定哪些属性的变化可以被监控到，通过<code>observedAttributes</code>函数指定：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 指定需要观察的属性</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">get</span> <span class="title function_">observedAttributes</span>() &#123;</span><br><span class="line">  <span class="keyword">return</span> [<span class="string">&#x27;disabled&#x27;</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样，当<code>disabled</code>属性被修改或移除(<code>setAttribute,remoteAttribute</code>)时，<code>attributeChangedCallback</code>将被<strong>同步</strong>调用</p>
</li>
<li><p><code>adoptedCallback</code></p>
<p>当元素从当前文档移到另一个文档时被调用，移动的方式是<a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/Document/adoptNode">document.adoptNode</a></p>
</li>
</ul>
<h1 id="自定义元素的”升级”-upgrade"><a href="#自定义元素的”升级”-upgrade" class="headerlink" title="自定义元素的”升级”(upgrade)"></a>自定义元素的”升级”(upgrade)</h1><p>我们可以在自定义元素被注册之前就使用它：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">x-clock</span>&gt;</span><span class="tag">&lt;/<span class="name">x-clock</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这个时候系统知道这些元素是自定义元素，但是是未定义的(<code>undefined</code>)，我们可以在后面再使用<code>customElements.define</code>来注册它，一旦被注册，这些未定义的元素就自动”升级(upgrade)”。</p>
<p>我们可以使用<code>customElements.whenDefined</code>来得知一个元素什么时候被定义了：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">customElements.<span class="title function_">whenDefined</span>(<span class="string">&#x27;x-clock&#x27;</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;x-clock defined&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>我们来测试一下，页面如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>现在是未定义的：<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;reg&quot;</span>&gt;</span>点击注册clock<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">x-clock</span>&gt;</span><span class="tag">&lt;/<span class="name">x-clock</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;main.mjs&quot;</span> <span class="attr">type</span>=<span class="string">&quot;module&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="../images/1540262306376.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// clock.mjs</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">HTMLClockElement</span> <span class="keyword">extends</span> <span class="title class_ inherited__">HTMLElement</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">innerHTML</span> = <span class="string">&#x27;i am a clock custom element&#x27;</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;custom element created&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 指定需要观察的属性</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">get</span> <span class="title function_">observedAttributes</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> [<span class="string">&#x27;disabled&#x27;</span>];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">connectedCallback</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;insert into dom&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">disconnectedCallback</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;removed from dom&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">attributeChangedCallback</span>(<span class="params">attrName, oldVal, newVal</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;attrName&#125;</span> changed from <span class="subst">$&#123;oldVal&#125;</span> to <span class="subst">$&#123;newVal&#125;</span>`</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">adoptedCallback</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;move to new document&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.mjs</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">HTMLClockElement</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./clock.mjs&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;reg&#x27;</span>).<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  customElements.<span class="title function_">define</span>(<span class="string">&#x27;x-clock&#x27;</span>, <span class="title class_">HTMLClockElement</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">customElements.<span class="title function_">whenDefined</span>(<span class="string">&#x27;x-clock&#x27;</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;x-clock defined&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>刚开始的时候自定义元素没有注册，虽然我们使用了它，但是控制台没有任何打印任何信息，元素内容也没有渲染出来；当我们点击按钮时，元素被注册，内容也渲染出来了：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="../images/1540262867740.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="../images/1540262877824.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h1 id="自定义元素的展示"><a href="#自定义元素的展示" class="headerlink" title="自定义元素的展示"></a>自定义元素的展示</h1><h2 id="内容"><a href="#内容" class="headerlink" title="内容"></a>内容</h2><p>自定义元素默认是空的，没有内容也没有样式，这显然没啥卵用，我们第一步先填充点内容，最简单的方式是直接在标签里面指定内容，就像普通的<code>div</code>元素一样：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">x-clock</span>&gt;</span>i am a clock<span class="tag">&lt;/<span class="name">x-clock</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="../images/1540264685155.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<p>这个时候自定义元素的内容完全取决于使用者，一般我们是不会这样做的，因为使用自定义元素(进而是web component)就是为了封装，所以一般是自己控制里面的内容。</p>
<p>可以在<code>constructor</code>中直接设置<code>innerHTML</code>属性(注意：在<code>constructor</code>中能做的事有一定的限制<a target="_blank" rel="noopener" href="https://html.spec.whatwg.org/multipage/custom-elements.html#custom-element-conformance">spec</a>)：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">   <span class="variable language_">super</span>();</span><br><span class="line">   <span class="variable language_">this</span>.<span class="property">innerHTML</span> = <span class="string">&#x27;i am a clock&#x27;</span></span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;custom element created&#x27;</span>)</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<h2 id="样式"><a href="#样式" class="headerlink" title="样式"></a>样式</h2><p>自定义标签和其他标签一样，可以为它设置任何样式，如：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">x-clock &#123;</span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">40px</span>;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid blue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>效果：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="../images/1540264712762.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<p>为了更好地控制元素注册前后的展示效果，我们可以利用<code>:defined</code>伪类，它可以用来选取一定注册了的自定义元素，所以我们可以给未注册的元素单独设置样式：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x-clock<span class="selector-pseudo">:not</span>(<span class="selector-pseudo">:defined</span>) &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>自定义元素作为web component的重要组成部分，使得我们可以定制新的标签，标签中的内容由自己定义，有一定的封装作用。但是一旦元素被渲染出来，它和其他内置元素完全一样：里面的dom结构完全暴露在外面(通过document.queryBy***直接获取)，它的内部dom样式也会受外部css的影响，这离我们想要的组件封装还有一定的距离。</p>
<p>web component另一个组成部分是shadow dom，它就是来解决上面提到的封装问题的，后面会单独讲</p>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2023-07-18T03:20:12.568Z" itemprop="dateUpdated">2023-07-18 11:20:12</time>
</span><br>


    </div>
    
    <footer>
        <a href="http://tomwang1013.github.io">
            <img src="/img/avatar.jpg" alt="wang xiantong">
            wang xiantong
        </a>
    </footer>
</blockquote>

        


        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/html5/" rel="tag">html5</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web-component/" rel="tag">web component</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://tomwang1013.github.io/web-componet-custom-element/&title=《web component之custom element》 — tomwang1013的学习总结&pic=http://tomwang1013.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://tomwang1013.github.io/web-componet-custom-element/&title=《web component之custom element》 — tomwang1013的学习总结&source=web开发，前端技术总结" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://tomwang1013.github.io/web-componet-custom-element/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《web component之custom element》 — tomwang1013的学习总结&url=http://tomwang1013.github.io/web-componet-custom-element/&via=http://tomwang1013.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://tomwang1013.github.io/web-componet-custom-element/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/web-component-shadow-dom/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">web component之shadow dom</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/topk/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">随手练练：O(n)时间复杂度解决topk</h4>
      </a>
    </div>
  
</nav>



    




















</article>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>博客内容遵循 <a rel="license noopener" target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>wang xiantong &copy; 2015 - 2023</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://tomwang1013.github.io/web-componet-custom-element/&title=《web component之custom element》 — tomwang1013的学习总结&pic=http://tomwang1013.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://tomwang1013.github.io/web-componet-custom-element/&title=《web component之custom element》 — tomwang1013的学习总结&source=web开发，前端技术总结" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://tomwang1013.github.io/web-componet-custom-element/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《web component之custom element》 — tomwang1013的学习总结&url=http://tomwang1013.github.io/web-componet-custom-element/&via=http://tomwang1013.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://tomwang1013.github.io/web-componet-custom-element/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="//api.qrserver.com/v1/create-qr-code/?data=http://tomwang1013.github.io/web-componet-custom-element/" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: false };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>






<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = '死鬼去哪里了！';
            clearTimeout(titleTime);
        } else {
            document.title = '(つェ⊂)咦!又好了!';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
